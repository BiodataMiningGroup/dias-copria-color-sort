biigle.$require("volumes.stores.sorters").push({id:"color",component:{template:"#color-sort-template",mixins:[biigle.$require("volumes.mixins.sortComponent")],components:{loader:biigle.$require("core.components.loader")},data:function(){return{title:"Sort images by color",text:"Color",volumeId:biigle.$require("volumes.volumeId"),fetchingColors:!0,colors:[],activeColor:null,cache:{},loadingSequence:!1,computingSequence:!1,newColor:"#000000"}},computed:{hasColors:function(){return this.colors.length>0},id:function(){return"color-"+this.activeColor},active:function(){return this.activeSorter.startsWith("color-")},canRequestNewColor:function(){return!this.fetchingColors&&!this.loadingSequence&&!this.computingSequence}},methods:{getSequence:function(){var e=this.activeColor,o=this;return this.cache.hasOwnProperty(e)?new Vue.Promise(function(i){i(o.cache[e])}):(this.loadingSequence=!0,biigle.$require("api.colorSortSequence").get({volume_id:this.volumeId,color:e}).then(this.parseResponse).then(function(i){return o.cache[e]=i,i})["finally"](function(){o.loadingSequence=!1}))},parseResponse:function(e){return e.data},initColors:function(e){this.colors=e.data},select:function(e){this.isActive(e)||this.loadingSequence||(this.activeColor=e,this.$emit("select",this))},isActive:function(e){return this.active&&e===this.activeColor},fetchColors:function(){var e=this;biigle.$require("api.colorSortSequence").query({volume_id:this.volumeId}).then(this.initColors)["catch"](biigle.$require("messages.store").handleErrorResponse)["finally"](function(){e.fetchingColors=!1})},requestNewColor:function(){this.computingSequence=!0;var e=this,o=this.newColor.substr(1);biigle.$require("api.colorSortSequence").save({volume_id:this.volumeId},{color:o}).then(function(i){e.cache[o]=i.data,e.colors.push(o),e.select(o)})["catch"](biigle.$require("messages.store").handleErrorResponse)["finally"](function(){e.computingSequence=!1})}},mounted:function(){biigle.$require("biigle.events").$once("sidebar.open.sorting",this.fetchColors),this.active&&(this.activeColor=this.activeSorter.substr(this.activeSorter.indexOf("-")+1))}}}),biigle.$declare("api.colorSortSequence",Vue.resource("api/v1/volumes{/volume_id}/color-sort-sequence{/color}"));